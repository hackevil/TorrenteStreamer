<html>
    <head>
        <title>Torrent streaming</title>
        <style type="text/css">
            .hidden{
                display: none;
            }
        </style>
    </head>
    <body>
        <form id="send">
            <p>
                <input type="file" id="torrent-file">
            </p>
            <p>
                <input type="text" id="magnet">
            </p>
            <p>
                <button type="submit">Stream</button>
            </p>
        </form>
        <div class="hidden">
            <p>
                <a href="#" id="stream-link">Click here to stream</a>
            </p>
        </div>
    </body>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

    <script type="text/javascript">
        function set_link() {
            $.getJSON('/query/torrents',
                {
                    filter : 'all',
                    sort : 'addition_date',
                    limit : '1'
                }, function(json, textStatus) {
                    $.ajax({
                        url: '/command/toggleSequentialDownload',
                        type: 'POST',
                        dataType: 'multipart/form-data',
                        data: {hashes: json[0].hash},
                    })
                    .done(function() {
                        $("#stream-link").attr('href', 'http://v1415.zapto.org/Torrent/' + json[0].name);
                    });
                }
            );
        }

        $("#send").submit(function(event){
            event.preventDefault();
            magnet = $("#magnet").val();
            if (!magnet) {
                //torrent file

            } else {
                //magnet
                $.ajax({
                    url: '/command/download',
                    type: 'POST',
                    dataType: 'multipart/form-data',
                    data: {urls: escape(magnet)},
                })
                .done(function() {
                    set_link();
                });
            }
        });
    </script>
</html>